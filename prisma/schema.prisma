// This is your Prisma schema file for reference
// For Supabase, we'll use direct SQL, but this documents the structure

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tool {
  id            String   @id @default(uuid())
  slug          String   @unique
  name          String
  tagline       String?
  description   String
  longDescription String? @db.Text
  category      String
  subcategory   String?
  websiteUrl    String
  affiliateLink String?
  logoUrl       String?
  screenshotUrl String?
  pricingModel  String   @default("freemium") // free, freemium, paid, subscription
  startingPrice String?
  features      String[] @default([])
  tags          String[] @default([])
  rating        Float?   @default(0)
  reviewCount   Int      @default(0)
  isSponsored   Boolean  @default(false)
  isFeatured    Boolean  @default(false)
  status        String   @default("published") // draft, published, archived
  views         Int      @default(0)
  clicks        Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  publishedAt   DateTime?

  reviews       Review[]
  clickLogs     ClickLog[]
  favorites     Favorite[]
  toolReviews   ToolReview[]
  browseHistory BrowseHistory[]
  socialProof   SocialProof?
}

model Review {
  id          String   @id @default(uuid())
  toolId      String
  title       String
  content     String   @db.Text
  prosHtml    String?  @db.Text
  consHtml    String?  @db.Text
  verdict     String?  @db.Text
  rating      Float?
  author      String   @default("ToolForge Team")
  status      String   @default("draft") // draft, published, archived
  seoTitle    String?
  seoDescription String?
  keywords    String[] @default([])
  readTime    Int?     // minutes
  views       Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  publishedAt DateTime?

  tool        Tool     @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@index([toolId])
  @@index([status])
}

model Category {
  id          String   @id @default(uuid())
  slug        String   @unique
  name        String
  description String?
  icon        String?
  order       Int      @default(0)
  toolCount   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model ClickLog {
  id        String   @id @default(uuid())
  toolId    String
  ipHash    String?
  userAgent String?
  referrer  String?
  createdAt DateTime @default(now())

  tool      Tool     @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@index([toolId])
  @@index([createdAt])
}

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  emailVerified DateTime? @map("email_verified")
  name          String?
  image         String?
  role          String    @default("user") // user, admin
  stripeCustomerId String? @map("stripe_customer_id")
  subscriptionStatus String? @map("subscription_status") // active, canceled, past_due
  subscriptionPlan String? @map("subscription_plan") // free, pro, premium
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  accounts      Account[]
  sessions      Session[]
  favorites     Favorite[]
  userCollections UserCollection[]
  toolReviews   ToolReview[]
  blogComments  BlogComment[]
  browseHistory BrowseHistory[]

  @@map("users")
}

model Account {
  id                String  @id @default(uuid())
  userId            String  @map("user_id")
  type              String
  provider          String
  providerAccountId String  @map("provider_account_id")
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
  @@index([userId])
  @@map("accounts")
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique @map("session_token")
  userId       String   @map("user_id")
  expires      DateTime
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

model Favorite {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  toolId    String   @map("tool_id")
  notes     String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  tool Tool @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@unique([userId, toolId])
  @@index([userId])
  @@index([toolId])
  @@index([createdAt])
  @@map("favorites")
}

model UserCollection {
  id          String   @id @default(uuid())
  userId      String   @map("user_id")
  name        String
  description String?  @db.Text
  toolIds     String[] @default([]) @map("tool_ids")
  icon        String?
  color       String?
  isPublic    Boolean  @default(false) @map("is_public")
  slug        String?  @unique
  views       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isPublic])
  @@index([createdAt])
  @@map("user_collections")
}

model ToolReview {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  toolId    String   @map("tool_id")
  rating    Float
  title     String?
  content   String?  @db.Text
  isVerified Boolean @default(false) @map("is_verified")
  helpful   Int      @default(0)
  notHelpful Int     @default(0) @map("not_helpful")
  status    String   @default("pending") // pending, approved, rejected
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  tool Tool @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@unique([userId, toolId])
  @@index([userId])
  @@index([toolId])
  @@index([status])
  @@index([createdAt])
  @@map("tool_reviews")
}

model BlogComment {
  id         String   @id @default(uuid())
  userId     String   @map("user_id")
  postId     String   @map("post_id")
  content    String   @db.Text
  parentId   String?  @map("parent_id")
  helpful    Int      @default(0)
  notHelpful Int      @default(0) @map("not_helpful")
  status     String   @default("pending") // pending, approved, rejected, spam
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  user   User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  post   BlogPost   @relation(fields: [postId], references: [id], onDelete: Cascade)
  parent BlogComment? @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies BlogComment[] @relation("CommentReplies")

  @@index([userId])
  @@index([postId])
  @@index([parentId])
  @@index([status])
  @@index([createdAt])
  @@map("blog_comments")
}

model BrowseHistory {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  toolId    String   @map("tool_id")
  viewedAt  DateTime @default(now()) @map("viewed_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  tool Tool @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([toolId])
  @@index([viewedAt])
  @@map("browse_history")
}

model UserPreference {
  id                    String   @id @default(uuid())
  userId                String   @unique @map("user_id")
  emailNotifications    Boolean  @default(true) @map("email_notifications")
  newToolsAlert         Boolean  @default(true) @map("new_tools_alert")
  favoriteCategoryAlert Boolean  @default(true) @map("favorite_category_alert")
  weeklyDigest          Boolean  @default(true) @map("weekly_digest")
  favoriteCategories    String[] @default([]) @map("favorite_categories")
  theme                 String   @default("light")
  language              String   @default("en")
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  @@map("user_preferences")
}

model SocialProof {
  id           String   @id @default(uuid())
  toolId       String   @map("tool_id")
  favoriteCount Int     @default(0) @map("favorite_count")
  reviewCount   Int     @default(0) @map("review_count")
  avgRating     Float   @default(0) @map("avg_rating")
  viewsLast7Days Int    @default(0) @map("views_last_7_days")
  viewsLast30Days Int   @default(0) @map("views_last_30_days")
  trendingScore Float   @default(0) @map("trending_score")
  updatedAt     DateTime @updatedAt @map("updated_at")

  tool Tool @relation(fields: [toolId], references: [id], onDelete: Cascade)

  @@unique([toolId])
  @@index([trendingScore])
  @@map("social_proof")
}

model ScrapedSource {
  id          String   @id @default(uuid())
  sourceUrl   String
  toolName    String
  toolUrl     String?
  description String?
  category    String?
  rawData     String?  @db.Text
  status      String   @default("pending") // pending, processed, ignored
  processedAt DateTime?
  createdAt   DateTime @default(now())

  @@index([status])
  @@index([createdAt])
}

model BlogPost {
  id              String    @id @default(uuid())
  slug            String    @unique
  title           String
  content         String    @db.Text
  excerpt         String?
  author          String    @default("ToolForge Team")
  featuredImage   String?   @map("featured_image")
  category        String
  tags            String[]  @default([])
  status          String    @default("draft") // draft, published, archived
  seoTitle        String?   @map("seo_title")
  seoDescription  String?   @map("seo_description")
  keywords        String[]  @default([])
  views           Int       @default(0)
  readTime        Int?      @map("read_time") // minutes
  publishedAt     DateTime? @map("published_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  comments        BlogComment[]

  @@index([slug])
  @@index([status])
  @@index([category])
  @@index([publishedAt])
  @@index([createdAt])
  @@index([views])
  @@map("blog_posts")
}

model Comparison {
  id              String    @id @default(uuid())
  slug            String    @unique
  title           String
  description     String?
  toolIds         String[]  @map("tool_ids")
  comparisonData  Json      @default("{}") @map("comparison_data")
  winnerToolId    String?   @map("winner_tool_id")
  seoTitle        String?   @map("seo_title")
  seoDescription  String?   @map("seo_description")
  keywords        String[]  @default([])
  views           Int       @default(0)
  status          String    @default("published") // draft, published, archived
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@index([slug])
  @@index([status])
  @@index([createdAt])
  @@index([views])
  @@map("comparisons")
}

model Collection {
  id              String    @id @default(uuid())
  slug            String    @unique
  name            String
  description     String?
  toolIds         String[]  @default([]) @map("tool_ids")
  icon            String?
  color           String?
  featuredImage   String?   @map("featured_image")
  seoTitle        String?   @map("seo_title")
  seoDescription  String?   @map("seo_description")
  keywords        String[]  @default([])
  views           Int       @default(0)
  orderIndex      Int       @default(0) @map("order_index")
  status          String    @default("published") // draft, published, archived
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  @@index([slug])
  @@index([status])
  @@index([orderIndex])
  @@index([createdAt])
  @@index([views])
  @@map("collections")
}

model BlogCategory {
  id          String   @id @default(uuid())
  slug        String   @unique
  name        String
  description String?
  icon        String?
  color       String?
  orderIndex  Int      @default(0) @map("order_index")
  postCount   Int      @default(0) @map("post_count")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@index([slug])
  @@index([orderIndex])
  @@map("blog_categories")
}

model EmailSubscriber {
  id             String    @id @default(uuid())
  email          String    @unique
  status         String    @default("active") // active, unsubscribed, bounced
  source         String    @default("popup") // popup, inline, footer, api
  variant        String?   // A/B test variant
  ipHash         String?   @map("ip_hash")
  userAgent      String?   @map("user_agent")
  referrer       String?
  metadata       Json?     // Additional tracking data
  confirmedAt    DateTime? @map("confirmed_at")
  unsubscribedAt DateTime? @map("unsubscribed_at")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedAt      DateTime  @updatedAt @map("updated_at")

  analytics EmailAnalytic[]

  @@index([status])
  @@index([source])
  @@index([createdAt])
  @@map("email_subscribers")
}

model NewsletterSend {
  id              String    @id @default(uuid())
  subject         String
  contentHtml     String    @map("content_html") @db.Text
  contentText     String?   @map("content_text") @db.Text
  recipientsCount Int       @default(0) @map("recipients_count")
  sentCount       Int       @default(0) @map("sent_count")
  failedCount     Int       @default(0) @map("failed_count")
  openedCount     Int       @default(0) @map("opened_count")
  clickedCount    Int       @default(0) @map("clicked_count")
  status          String    @default("draft") // draft, scheduled, sending, sent, failed
  scheduledAt     DateTime? @map("scheduled_at")
  sentAt          DateTime? @map("sent_at")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  analytics EmailAnalytic[]

  @@index([status])
  @@index([sentAt])
  @@map("newsletter_sends")
}

model EmailAnalytic {
  id           String   @id @default(uuid())
  subscriberId String   @map("subscriber_id")
  newsletterId String   @map("newsletter_id")
  eventType    String   @map("event_type") // opened, clicked, bounced, complained
  ipHash       String?  @map("ip_hash")
  userAgent    String?  @map("user_agent")
  createdAt    DateTime @default(now()) @map("created_at")

  subscriber EmailSubscriber @relation(fields: [subscriberId], references: [id], onDelete: Cascade)
  newsletter NewsletterSend  @relation(fields: [newsletterId], references: [id], onDelete: Cascade)

  @@index([subscriberId])
  @@index([newsletterId])
  @@index([eventType])
  @@index([createdAt])
  @@map("email_analytics")
}
